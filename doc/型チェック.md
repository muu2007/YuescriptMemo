# 型チェック

luaの周辺ツールである型チェッカを利用するのは厳しそう。理由は以下

- luaが自由すぎる。

  - 成功したときは結果を返し、失敗したときはnilとエラーメッセージを返す
  - lume.firstのように引数が違うと返すものが違うものがある
  - 型がない→すべての関数がgenericとも捉えられ、numberを主に使うものでもstringがmetamethodがついたテーブルでも使える
  - stringは正規表現、ファイルパス、日付と時刻、モードにつかう列挙体の要素、バイト配列などを代用する。
    テーブルは辞書だが、配列、タプル、クラスやインスタンスなどを代用する。
    そのため型だけチェックしたとしても有用性が低そう。

- yueがトランスコンパイラで有ることによる制限もある。

  - コメントを残さない。残るコメントもつけてほしい関数でないものについてしまう。
  - 必ず最後の文をreturnするため、揃えない記述になる場合がある(戻り値がvoid/discardのとき)が、lua用の型チェッカはそれに対応しないだろう。

## 対応策

無いものにこだわってもしょうがない。

### エディタサポート

引数のわからないものは、いちいちブラウザで調べないといけないという点で、インテリセンスなどはとても時間を節約する機能であると言える。
仕方がないのでneosnippet-snippetsに使う全関数の情報を書いてみる(あるいは辞書にして引けるようにする？)。Uniteで候補を絞れるのである程度は役に立つと思う。

### 型チェック

ないのでテストを同じファイルに書く
型チェックとは違うが、引数を間違ったものを渡すテストを通すには、引数チェックのassertも書かなければならないし、
その動作(正常系でない)のドキュメントにもなる。

関数引数のassertでのチェックは、luaでは通常経路の一部(falseの時エラーを投げる)。
コマンドラインオプションにdebugなどはない。

### 引数初期値を書くことで、nilを許さないことはできる

### 単位を合字(unicode)に設定して呼び出しに使う

[idea]メタテーブルを設定する関数とそれをチェックする静的チェッカ

```yuecode.lua
㍍ = => setmetatable(@, {TYPE: '㍍'})
foo(1 |>㍍) -- パイプの優先順位は単項演算子とmuldivの間のことに注意

foo = (n__㍍)
```

---

## tl check

現状tl checkは大量のwarning/errorが出る。

## LuaLS

何も書かなければ何もチェックされない?
VSCodeでは動くのにVim.ALEでは動かない(実行ファイルを~/.local/binにリンク作ったのに)
VSCodeでloveなどレポートを消してゆく
math/stringなどに関数を追加しているとレポートされる→utlのほうがいい
前方宣言をvar = nilと書いているとneed nil checkとレポートされる。local varだとされない。

## Luau check

まだ試してない
