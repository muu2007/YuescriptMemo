# Love2Dの細かい部分

- `gr = love.graphics`としている
- colorはresetなどですぐ変わってしまうため描画とセットで指定(コードゴルフ的に描画命令とまとめることもある)
- drawするときはcolorが白でないと色が変わってしまう
- noiseはそのままではperlinノイズを生成すものではない
- physicsでスイカゲーム作った。面白そうな例がないと使い道が思い浮かばない

## サードパーティ製ライブラリ

maid64
: カンバス

tween.lua
: アニメーションに
delayができるようにチェックを外す改造をしてある

love-loader
: 別スレッドでのリソースの読み込み

sqlite3
: 使ってない。マルチスレッドに対応するのかな？

3DreamEngine(3D描画)、Transfrom(親子関係？)、tove(svgの描画)

## lua以外の部分

luajitのffi整数での速い計算
ffiでCやZig言語を使った速い計算
GLSLを使ったシェーダー

速度を見るときはVsyncを外して60FPS以上にする。

## hotswap

できることは確認したが、活用できてない
ほぼmain.luaになるyueファイルをいじっているだけなので
love.loadに書いたものは２回実行されない

## gifcat

画面のキャプチャがgifで保存できる
maid64.canvasを保存することにした。そうでないと暗くなる(環境による？)
60fpsのgifは開けるアプリが無い？
保存中は重くなる→12fpsにしてframe_count%5== 0にしたら、軽くなった
linuxのみ、c-f2で開始、f2かc-f2で終了にしている
init()を再度呼ばないと、２回目が使えない(一度も呼ばずに終了するとエラーなので最初の１回も必要)

## love.thread

利用は簡単。結果をchannelにいれて返す。遅い。パッケージ再読み込みが必要。

## ファイルの高速な読み方

- 結論: luaファイルにして`luajit -b`でバイトコードにする
- [注意] 64bitと32bitでバイトコードに互換性がない
- [注意] 各行を『キーと値(string)』以上に複雑にすると`main function has more than 65535 constants`というエラーが出て読めない
- マルチスレッドにすると起動時にブロッキングされなくなるが、読み込みまでは遅い

SKK の L 辞書を読む時間

| 名前                                      | 分類     | 説明                   | 備考                                 |
| ----------------------------------------- | -------- | ---------------------- | ------------------------------------ |
| シングルスレッド                          | 1.6s     | 各候補も分解して配列に |
| マルチスレッド                            | 3.5s     | 同上                   | 起動は早くなったが準備完了までは     |
| lua ファイルに変換                        | 読めない | 同上                   | `more than 65536 constants`          |
| シングルスレッド                          | 0.8s     | 候補はつながったまま   |
| lua ファイルに変換 (require で)           | 0.4s     | 同上                   | ネストした辞書でなければ読み込める？ |
| 更に luajit -b で bytecode に (dofile で) | 0.2s     | 同上                   |
