# マクロでデータ成形

## 現状スペースを含むデータをマクロに渡せない

データ記述、DSL的な記述が手作業なしでそのままluaになる。
DSLのフォーマット考えて読み込む型を考えて……なら、yueそのままDSLとして使えるのでは？(コードとして動いちゃう弱点があるけど)
データをluaに直せばluaの速度ではなくcの速度で読める(luajit -bするとより速い)

## トランスパイル時

マクロはシステムに入っているlua5.4で実行される
実行される環境(luajit)と別、マクロだけで使うライブラリなどは実行時にはなくて良い
Love2Dに含まれるライブラリを使いたければ、同じ機能のものをluarocksでインストールしなければならない
トランスパイル時は他言語のコンパイル時と同じ
自分のutl.yueはLove2Dがあること前提になってしまったのでマクロでは使えない

## マクロの動作の説明

```yuecode.lua
macro DATE = -> os.date("'%Y-%m-%d'")

-- $DATEでトランスコンパイル時の日付に変わる
```

- マクロは文字列で引数を渡し、文字列で式を返す。
  よって文字列(の式)を返したければ２重のクォーテーションが必要。
- 引数がない時呼び出しのカッコを省略できる
- `$macroA()`で式を、`$macorB[[]]`でデータを渡したいが現状そうなってない。

## マクロの使い道

> マクロの効用
> マクロの危険
> というページから。
>
> マクロでできること
>
> - 文字の節約、
> - インライン展開の代用(高速化)
> - 引数の評価の制御、抑制(評価しないや、短絡評価などか？)
> - トランスコンパイル時の呼び出し元ソースコードへの展開
> - 呼び出し元の変数を使うこともできる(ダイナミックスコープ？)
>
> 具体的なユースケース
>
> - 定形パターンの簡略化 → コアコードを浮かび上がらせる
> - 新しい構文の代用 → 十分そろってるよ？
> - ミニ言語の埋め込み
> - 宣言的コードに見せる
> - コンパイル時の処理

ミニ言語の埋め込みに他プログラムの呼び出しを使える
(現状:変更するたびに tmp と出力先フォルダにゴミが残る……)

## zigマクロ mml2oggマクロ

埋め込みで書くのは楽しいが、埋め込みが有用かというと……
zigはコンパイラキャッシュがあるので毎回コンパイルしても初回のみ時間がかかるが、それがないものは自分で作らなければならない。
